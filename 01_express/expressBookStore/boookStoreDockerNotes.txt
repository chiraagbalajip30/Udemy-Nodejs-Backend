Video - 51
------------
Migrating Book Store to Drizzle ORM - Part 1: Schema Setup


Firstly, we need to create a docker-compose.yml file. 
Talking about ports in .yml file, we can set it as 5431 but the defaut must be -542:5432. So., it's better to delete the old containers running on that port in docker(previous video is running on this port so delete it).

Chatgpt Content:
-----------------
image in docker-compose.yml file:

instead of installing:
PostgreSQL,
Dependencies,
OS libraries,
Configuration,
Docker just pulls the image which already contains everything.



Why do we need Drizzle-kit?

Why do we need drizzle-kit?

Remember â€” in Drizzle you define tables in code like:

pgTable("users", {...})

But writing schema in code alone does NOT create tables in the database.

ğŸ‘‰ You still need to update the actual database.

Thatâ€™s where drizzle-kit comes in.

What drizzle-kit does in simple words

ğŸ‘‰ It converts your schema code â†’ SQL migration files
ğŸ‘‰ Then applies those migrations to your database

So, users creates a schema, then it calls dizzle-generate, and then drizzle-migration, and then npx drizzle-kit push.


Course Content:
Then, we installed npm i dotenv, npm i drizzle-orm pg, and npm i drizzle-kit.
Now , all the packages are installed. 


Setup everything that is files. Schema.js is created inside models folder, and is renamed as book.model.js.

// These kind of Foreign-Table relationships are not possible in MongoDB

We use 'references with an arrow function" to link one table model to another table model.

 authorId: uuid().references(() => authorsTable.id).notNull()


 In drizzle.config.js file, we have to mention the schema. But our schema is fragmented into two files i.e., authorMode.js and bookModel.js. So, here are two ways:
 1. we can just mention the main directory of the files i.e., models. -> not tried, so not sure which was told in the course.
 2. We can create an index.js file inside the models folder, and we can import both the authorMode.js and bookModel.js, and use that as file for schema.


 After all these steps, now we must initiate the docker that is, turn on the database by typing "docker compose up -d". Then we have to push the tables in the public schema so we need to type "npx drizzle-kit push".  After this has been created, we must type "npx drizzle-kit studio". Now you will get a link that is https://local.drizzle.studio


 Then you wll see the tables in the link. You can also add data in the drizzle link by selectinng the table or model, and then clicking "Add Record" button.  


 Video - 52
 -----------
Migrating Book Store to Drizzle ORM - Part 2


I have created a copy of book.controller.js as bookCopy.controller.js, and have kept the old code untouched. It helps in comparision between old and new code.


 if (isNaN(id)) {
    return res.status(400).json({ error: `Id must be of type number` });
  }
  This condition will be removed in the new code because uuid will be used as id is not a string. 

  Instead of writing Book((e) => books.id === e.id,  ere we write or use eqyal that is eq which must be imported from drizzle-orm.)


  We need to use const [book]  as book inside an array which is called as array destructing because the db returns an array, and we only need one/first part of it that is id(first part).


  So when should we use [variable]?

ğŸ‘‰ When you expect ONE result from an array

Common cases:

âœ… limit(1) queries
âœ… find first record
âœ… unique ID search
âœ… login user lookup
âœ… checking existence



When NOT to use [ ]

When you expect multiple rows:

const books = await db.select().from(booksTable);

Because you want full list.

Why ORMs always return arrays

Because SQL SELECT can return multiple rows â€” ORM keeps return type consistent.





In createBook, we donot need to return author as in old code. We need to return the authorId. 

 if (!author || author === "") {
    return res.status(400).json({ error: `Author is required` });
  }

  const id = BOOKS.length + 1;

  const book = { id, title, author };
  BOOKS.push(book);

  So wew ill be removing the above code, and typing a new code for inserting into the db whch can be viewed in the code. 


  In createBooks, we need to return id because:
  âœ… 4 â€” Best practice in REST APIs

Standard pattern:

POST â†’ return created resource or id


ğŸ† Real industry rule of thumb

ğŸ‘‰ POST APIs usually return created id or object

So .returning() is very common.

ğŸ”¥ Simple analogy

Imagine submitting a form at office.

Without returning â†’ you drop form and leave

With returning â†’ you get receipt number

That receipt number = id



const [result] = await db.insert(booksTable).values({title, description, authorId}).returning({id: booksTable.id,});


ğŸ“Š Mental model

Database always returns:

ğŸ‘‰ Table (rows) â†’ Array

We pick first row â†’ [row]

ğŸ† One-line takeaway

âœ… Yes â€” we are grabbing the first element from the array returned by the insert query



Syntax of delete and getbyid are differenet. So i asked is it differenet?

Great question ğŸ‘ â€” youâ€™re comparing two different query styles and wondering if theyâ€™re interchangeable.

Short answer:

ğŸ‘‰ They are NOT interchangeable
ğŸ‘‰ They are used for DIFFERENT operations
ğŸ‘‰ Syntax difference is because of how Drizzle API works




| Operation | Syntax             | Why                    |
| --------- | ------------------ | ---------------------- |
| SELECT    | `.select().from()` | Need to specify source |
| DELETE    | `.delete(table)`   | Table already provided |
| INSERT    | `.insert(table)`   | Table already provided |
| UPDATE    | `.update(table)`   | Table already provided |



â­ Industry style recommendation

Most developers prefer:

.where(eq(booksTable.id, id))




Video - 53
-------------
Testing your REST APIs in POSTMAN



We must create a collection named Book STore as we can store all the routes within it.
Then instaed of typing http://localhost:800 for the routes every time, we can create an environment, and there we can assign any name we want which we have assigned as BASE_URl here, and we can assign the link next to it, and we can set the environment as the created env name, and then use BAE_URL along with the links. 




